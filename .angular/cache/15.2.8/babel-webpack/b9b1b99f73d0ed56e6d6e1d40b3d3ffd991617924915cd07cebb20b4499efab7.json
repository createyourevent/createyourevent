{"ast":null,"code":"import { UserPointAssociation } from \"app/entities/user-point-association/user-point-association.model\";\nimport * as dayjs from \"dayjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"app/entities/image/service/image.service\";\nimport * as i2 from \"app/general.service\";\nimport * as i3 from \"app/points/points-display/points-display.service\";\nimport * as i4 from \"app/entities/user-point-association/service/user-point-association.service\";\nimport * as i5 from \"primeng/api\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@fortawesome/angular-fontawesome\";\nimport * as i8 from \"../../../shared/language/translate.directive\";\nimport * as i9 from \"primeng/fileupload\";\nimport * as i10 from \"../gallery-event/gallery-event.component\";\nfunction AdminGalleryEventComponent_ng_container_12_ng_template_4_ul_1_li_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const file_r5 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\"\", file_r5.name, \" - \", file_r5.size, \" bytes\");\n  }\n}\nfunction AdminGalleryEventComponent_ng_container_12_ng_template_4_ul_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\");\n    i0.ɵɵtext(1, \"\\n                \");\n    i0.ɵɵtemplate(2, AdminGalleryEventComponent_ng_container_12_ng_template_4_ul_1_li_2_Template, 2, 2, \"li\", 4);\n    i0.ɵɵtext(3, \"\\n            \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.uploadedFiles);\n  }\n}\nfunction AdminGalleryEventComponent_ng_container_12_ng_template_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"\\n            \");\n    i0.ɵɵtemplate(1, AdminGalleryEventComponent_ng_container_12_ng_template_4_ul_1_Template, 4, 1, \"ul\", 3);\n    i0.ɵɵtext(2, \"\\n        \");\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.uploadedFiles.length);\n  }\n}\nfunction AdminGalleryEventComponent_ng_container_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \"\\n    \");\n    i0.ɵɵelementStart(2, \"p-fileUpload\", 6);\n    i0.ɵɵlistener(\"onUpload\", function AdminGalleryEventComponent_ng_container_12_Template_p_fileUpload_onUpload_2_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.onUpload($event));\n    });\n    i0.ɵɵtext(3, \"\\n        \");\n    i0.ɵɵtemplate(4, AdminGalleryEventComponent_ng_container_12_ng_template_4_Template, 3, 1, \"ng-template\", 7);\n    i0.ɵɵtext(5, \"\\n    \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(6, \"\\n\");\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"url\", ctx_r0.url)(\"fileLimit\", ctx_r0.fileLimit);\n  }\n}\nfunction AdminGalleryEventComponent_ng_container_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \"\\n        \");\n    i0.ɵɵelementStart(2, \"div\", 8);\n    i0.ɵɵtext(3, \"\\n            \");\n    i0.ɵɵelement(4, \"img\", 9);\n    i0.ɵɵtext(5, \"\\n\\n            \");\n    i0.ɵɵelementStart(6, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function AdminGalleryEventComponent_ng_container_16_Template_button_click_6_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r10);\n      const image_r8 = restoredCtx.$implicit;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.deleteImage(image_r8.id));\n    });\n    i0.ɵɵtext(7, \"\\n                \");\n    i0.ɵɵelement(8, \"fa-icon\", 11);\n    i0.ɵɵtext(9, \"\\n                \");\n    i0.ɵɵelementStart(10, \"span\", 12);\n    i0.ɵɵtext(11, \"Delete\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(12, \"\\n            \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(13, \"\\n        \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(14, \"\\n    \");\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const image_r8 = ctx.$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"src\", \"data:\" + image_r8.imageContentType + \";base64,\" + image_r8.image, i0.ɵɵsanitizeUrl);\n  }\n}\nexport let AdminGalleryEventComponent = /*#__PURE__*/(() => {\n  class AdminGalleryEventComponent {\n    constructor(imageService, generalService, pointsDataService, userPointAssociationService) {\n      this.imageService = imageService;\n      this.generalService = generalService;\n      this.pointsDataService = pointsDataService;\n      this.userPointAssociationService = userPointAssociationService;\n      this.uploadedFiles = [];\n      this.fileLimit = 10;\n    }\n    ngOnInit() {\n      this.url = '/api/upload/' + this.jhiEvent.id + '/' + this.user.id + '/event';\n      this.generalService.findImagesByEventId(this.jhiEvent.id).subscribe(res => {\n        this.images = res.body;\n        this.fileLimit = 10 - this.images.length;\n      });\n    }\n    ngOnChanges(changes) {\n      if (changes['jhiEvent'] !== undefined) {\n        this.jhiEvent = changes['jhiEvent'].currentValue;\n        this.ngOnInit();\n      }\n      if (changes['user'] !== undefined) {\n        this.user = changes['user'].currentValue;\n        this.ngOnInit();\n      }\n    }\n    onUpload(e) {\n      for (const file of e.files) {\n        this.uploadedFiles.push(file);\n      }\n      this.generalService.findPointsByKey('upload_image_event').subscribe(p => {\n        const points = p.body;\n        this.generalService.findUserPointAssociationByUsersIdAndPointkey(this.user.id, points.key).subscribe(s => {\n          const upa = s.body;\n          const day = dayjs().date();\n          let i = 0;\n          upa.forEach(element => {\n            if (element.date.date() === day) {\n              i++;\n            }\n          });\n          if (i < points.countPerDay) {\n            const iupa = new UserPointAssociation();\n            iupa.users = this.user;\n            iupa.points = points;\n            iupa.date = dayjs();\n            this.userPointAssociationService.create(iupa).subscribe();\n            const img_points = points.points * this.uploadedFiles.length;\n            this.user.points += img_points;\n            this.user.loggedIn = true;\n            this.generalService.updateUserLoggedInAndPoints(this.user.id, this.user.loggedIn, this.user.points).subscribe(t => {\n              this.generalService.findWidthAuthorities().subscribe(k => {\n                this.pointsDataService.changePoint(k.body.points);\n              });\n            });\n          }\n        });\n      });\n      this.generalService.findImagesByEventId(this.jhiEvent.id).subscribe(res => {\n        this.images = res.body;\n        this.fileLimit = 10 - this.images.length;\n      });\n    }\n    deleteImage(imageId) {\n      this.imageService.delete(imageId).subscribe(() => {\n        this.generalService.findImagesByEventId(this.jhiEvent.id).subscribe(res => {\n          this.images = res.body;\n          this.fileLimit = 10 - this.images.length;\n        });\n      });\n    }\n  }\n  AdminGalleryEventComponent.ɵfac = function AdminGalleryEventComponent_Factory(t) {\n    return new (t || AdminGalleryEventComponent)(i0.ɵɵdirectiveInject(i1.ImageService), i0.ɵɵdirectiveInject(i2.GeneralService), i0.ɵɵdirectiveInject(i3.PointsDataService), i0.ɵɵdirectiveInject(i4.UserPointAssociationService));\n  };\n  AdminGalleryEventComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AdminGalleryEventComponent,\n    selectors: [[\"jhi-admin-gallery-event\"]],\n    inputs: {\n      jhiEvent: \"jhiEvent\",\n      user: \"user\"\n    },\n    features: [i0.ɵɵNgOnChangesFeature],\n    decls: 26,\n    vars: 3,\n    consts: [[\"role\", \"alert\", 1, \"alert\", \"alert-info\"], [\"jhiTranslate\", \"admin-gallery-event.title-gallery\"], [\"jhiTranslate\", \"admin-gallery-event.info\"], [4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [3, \"images\"], [\"name\", \"files\", \"multiple\", \"multiple\", \"accept\", \"image/*\", \"maxFileSize\", \"1000000\", 3, \"url\", \"fileLimit\", \"onUpload\"], [\"pTemplate\", \"content\"], [1, \"image\"], [\"alt\", \"image.name\", 2, \"max-height\", \"150px\", 3, \"src\"], [1, \"btn\", \"btn-danger\", \"btn-sm\", 3, \"click\"], [\"icon\", \"times\"], [\"jhiTranslate\", \"entity.action.delete\", 1, \"d-none\", \"d-md-inline\"]],\n    template: function AdminGalleryEventComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtext(0, \"\\n\");\n        i0.ɵɵelementStart(1, \"div\", 0);\n        i0.ɵɵtext(2, \"\\n    \");\n        i0.ɵɵelementStart(3, \"h1\", 1);\n        i0.ɵɵtext(4, \"Admin gallery\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(5, \"\\n    \");\n        i0.ɵɵelementStart(6, \"p\", 2);\n        i0.ɵɵtext(7, \"\\n        Here you can upload a maximum of 10 images for the event. For example, you can display old event photos or decorations, products or other images. In this way you can better advertise your event on the Internet.\\n    \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(8, \"\\n\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(9, \"\\n\");\n        i0.ɵɵelement(10, \"hr\");\n        i0.ɵɵtext(11, \"\\n\");\n        i0.ɵɵtemplate(12, AdminGalleryEventComponent_ng_container_12_Template, 7, 2, \"ng-container\", 3);\n        i0.ɵɵtext(13, \"\\n\");\n        i0.ɵɵelementStart(14, \"p\");\n        i0.ɵɵtext(15, \"\\n    \");\n        i0.ɵɵtemplate(16, AdminGalleryEventComponent_ng_container_16_Template, 15, 1, \"ng-container\", 4);\n        i0.ɵɵtext(17, \"\\n\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(18, \"\\n\");\n        i0.ɵɵelement(19, \"hr\");\n        i0.ɵɵtext(20, \"\\n\");\n        i0.ɵɵelementStart(21, \"p\");\n        i0.ɵɵtext(22, \"\\n    \");\n        i0.ɵɵelement(23, \"jhi-gallery-event\", 5);\n        i0.ɵɵtext(24, \"\\n\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(25, \"\\n\");\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(12);\n        i0.ɵɵproperty(\"ngIf\", ctx.jhiEvent && ctx.user && !((ctx.images == null ? null : ctx.images.length) >= 10));\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngForOf\", ctx.images);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"images\", ctx.images);\n      }\n    },\n    dependencies: [i5.PrimeTemplate, i6.NgForOf, i6.NgIf, i7.FaIconComponent, i8.TranslateDirective, i9.FileUpload, i10.GalleryEventComponent],\n    styles: [\".image[_ngcontent-%COMP%]{margin:15px}\"]\n  });\n  return AdminGalleryEventComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}