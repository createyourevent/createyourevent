{"ast":null,"code":"import _defineProperty from \"/home/ceo/mmmm/createyourevent/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"app/general.service\";\nimport * as i2 from \"app/organisator/organisator.service\";\nimport * as i3 from \"ng-jhipster\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"primeng/dataview\";\nimport * as i6 from \"primeng/api\";\nimport * as i7 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i8 from \"../../../shared/language/translate.directive\";\nfunction CrossSellingEventsComponent_ng_container_0_ng_template_9_ng_template_70_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"\\n                              \");\n    i0.ɵɵelementStart(1, \"span\", 19);\n    i0.ɵɵtext(2, \"\\n                                \");\n    i0.ɵɵelementStart(3, \"span\", 20);\n    i0.ɵɵtext(4, \"\\u2665\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(5, \"\\u2665\\n                              \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(6, \"\\n                            \");\n  }\n  if (rf & 2) {\n    const fill_r5 = ctx.fill;\n    i0.ɵɵadvance(1);\n    i0.ɵɵclassProp(\"full\", fill_r5 === 100);\n    i0.ɵɵadvance(2);\n    i0.ɵɵstyleProp(\"width\", fill_r5, \"%\");\n  }\n}\nfunction CrossSellingEventsComponent_ng_container_0_ng_template_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵtext(0, \"\\n                \");\n    i0.ɵɵelementStart(1, \"div\", 5);\n    i0.ɵɵtext(2, \"\\n                    \");\n    i0.ɵɵelementStart(3, \"div\", 6);\n    i0.ɵɵtext(4, \"\\n                        \");\n    i0.ɵɵelementStart(5, \"a\", 7);\n    i0.ɵɵtext(6, \"\\n                            \");\n    i0.ɵɵelementStart(7, \"h3\", 8);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(9, \"\\n                            \");\n    i0.ɵɵelementStart(10, \"div\", 9);\n    i0.ɵɵtext(11, \"\\n                                \");\n    i0.ɵɵelementStart(12, \"a\", 10);\n    i0.ɵɵlistener(\"click\", function CrossSellingEventsComponent_ng_container_0_ng_template_9_Template_a_click_12_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const event_r2 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r6.openFile(event_r2 == null ? null : event_r2.flyerContentType, event_r2 == null ? null : event_r2.flyer));\n    });\n    i0.ɵɵtext(13, \"\\n                                    \");\n    i0.ɵɵelement(14, \"img\", 11);\n    i0.ɵɵtext(15, \"\\n                                \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(16, \"\\n                            \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(17, \"\\n                            \");\n    i0.ɵɵelementStart(18, \"div\", 12);\n    i0.ɵɵtext(19, \"\\n                                \");\n    i0.ɵɵelement(20, \"hr\");\n    i0.ɵɵtext(21, \"\\n                                \");\n    i0.ɵɵelementStart(22, \"div\", 13);\n    i0.ɵɵtext(23, \"\\n                                  \");\n    i0.ɵɵelementStart(24, \"div\", 14);\n    i0.ɵɵtext(25, \"\\n                                    \");\n    i0.ɵɵelementStart(26, \"span\", 15);\n    i0.ɵɵtext(27, \"Placenumber\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(28, \"\\n                                  \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(29, \"\\n                                \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(30, \"\\n                                \");\n    i0.ɵɵelementStart(31, \"div\", 13);\n    i0.ɵɵtext(32, \"\\n                                  \");\n    i0.ɵɵelementStart(33, \"div\", 14);\n    i0.ɵɵtext(34, \"\\n                                    \");\n    i0.ɵɵelementStart(35, \"span\");\n    i0.ɵɵtext(36);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(37, \"\\n                                  \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(38, \"\\n                                \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(39, \"\\n                                \");\n    i0.ɵɵelementStart(40, \"div\", 13);\n    i0.ɵɵtext(41, \"\\n                                  \");\n    i0.ɵɵelementStart(42, \"div\", 14);\n    i0.ɵɵtext(43, \"\\n                                    \");\n    i0.ɵɵelementStart(44, \"span\", 16);\n    i0.ɵɵtext(45, \"Price\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(46, \"\\n                                  \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(47, \"\\n                                \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(48, \"\\n                                \");\n    i0.ɵɵelementStart(49, \"div\", 13);\n    i0.ɵɵtext(50, \"\\n                                  \");\n    i0.ɵɵelementStart(51, \"div\", 14);\n    i0.ɵɵtext(52, \"\\n                                    \");\n    i0.ɵɵelementStart(53, \"span\");\n    i0.ɵɵtext(54);\n    i0.ɵɵpipe(55, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(56, \"\\n                                  \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(57, \"\\n                                \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(58, \"\\n                                \");\n    i0.ɵɵelement(59, \"hr\");\n    i0.ɵɵtext(60, \"\\n                                \");\n    i0.ɵɵelementStart(61, \"div\");\n    i0.ɵɵtext(62);\n    i0.ɵɵpipe(63, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(64, \"\\n                                \");\n    i0.ɵɵelementStart(65, \"div\");\n    i0.ɵɵtext(66);\n    i0.ɵɵpipe(67, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(68, \"\\n                            \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(69, \"\\n                            \");\n    i0.ɵɵtemplate(70, CrossSellingEventsComponent_ng_container_0_ng_template_9_ng_template_70_Template, 7, 4, \"ng-template\", null, 17, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵtext(72, \"\\n\\n                            \");\n    i0.ɵɵelement(73, \"ngb-rating\", 18);\n    i0.ɵɵtext(74, \"\\n                        \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(75, \"\\n                    \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(76, \"\\n                \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(77, \"\\n            \");\n  }\n  if (rf & 2) {\n    const event_r2 = ctx.$implicit;\n    const _r3 = i0.ɵɵreference(71);\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵpropertyInterpolate1(\"href\", \"/events/\", event_r2.id, \"/view\", i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(event_r2.name);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"src\", \"data:\" + event_r2.flyerContentType + \";base64,\" + event_r2.flyer, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(22);\n    i0.ɵɵtextInterpolate2(\"\", event_r2.reservations.length, \"/\", event_r2.placenumber, \"\");\n    i0.ɵɵadvance(18);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(55, 12, event_r2.price));\n    i0.ɵɵadvance(8);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(63, 14, event_r2.dateStart, \"medium\"));\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(67, 17, event_r2.dateEnd, \"medium\"));\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"rate\", ctx_r1.getAverage(event_r2.id))(\"starTemplate\", _r3)(\"readonly\", true)(\"max\", 5);\n  }\n}\nfunction CrossSellingEventsComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \"\\n    \");\n    i0.ɵɵelementStart(2, \"div\", 1);\n    i0.ɵɵtext(3, \"\\n        \");\n    i0.ɵɵelementStart(4, \"h3\", 2);\n    i0.ɵɵtext(5, \"Customers who bought this also bought ...\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(6, \"\\n        \");\n    i0.ɵɵelementStart(7, \"p-dataView\", 3);\n    i0.ɵɵtext(8, \"\\n            \");\n    i0.ɵɵtemplate(9, CrossSellingEventsComponent_ng_container_0_ng_template_9_Template, 78, 20, \"ng-template\", 4);\n    i0.ɵɵtext(10, \"\\n        \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(11, \"\\n    \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(12, \"\\n\");\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"value\", ctx_r0.events)(\"paginator\", true)(\"rows\", 8);\n  }\n}\nexport class CrossSellingEventsComponent {\n  constructor(generalService, organisatorService, dataUtils) {\n    _defineProperty(this, \"generalService\", void 0);\n    _defineProperty(this, \"organisatorService\", void 0);\n    _defineProperty(this, \"dataUtils\", void 0);\n    _defineProperty(this, \"jhiEvent\", void 0);\n    _defineProperty(this, \"users\", []);\n    _defineProperty(this, \"allReservationsFromUsers\", []);\n    _defineProperty(this, \"events\", void 0);\n    _defineProperty(this, \"starEvents\", []);\n    _defineProperty(this, \"loaded\", false);\n    this.generalService = generalService;\n    this.organisatorService = organisatorService;\n    this.dataUtils = dataUtils;\n  }\n  ngOnChanges(changes) {\n    if (changes['jhiEvent'] !== undefined) {\n      this.jhiEvent = changes['jhiEvent'].currentValue;\n      this.loadReservations().then(() => {\n        this.loadUsers().then(() => {\n          this.loadReservationsFromUsers().then(() => {\n            this.loadCrossSellingEvents().then(() => {\n              this.loaded = true;\n            });\n          });\n        });\n      });\n    }\n  }\n  openFile(contentType, base64String) {\n    this.dataUtils.openFile(contentType, base64String);\n  }\n  loadStars(iEvent) {\n    let promise = new Promise((resolve, reject) => {\n      this.generalService.getEventStarRatingByEvent(iEvent.id).toPromise().then(res => {\n        const ratings = res.body;\n        let total = 0;\n        ratings.forEach(el => {\n          total += el.stars;\n        });\n        const avg = total / ratings.length / 10 * 5;\n        this.starEvents.push({\n          event: iEvent,\n          average: avg\n        });\n        resolve();\n      });\n    });\n    return promise;\n  }\n  loadUsers() {\n    let promise = new Promise((resolve, reject) => {\n      this.jhiEvent.reservations.forEach(reservation => {\n        this.users.push(reservation.user);\n      });\n      resolve();\n    });\n    return promise;\n  }\n  loadReservations() {\n    let promise = new Promise((resolve, reject) => {\n      this.organisatorService.findReservationsByEventId(this.jhiEvent.id).toPromise().then(res => {\n        this.jhiEvent.reservations = res.body;\n        resolve();\n      });\n    });\n    return promise;\n  }\n  loadReservationsFromUsers() {\n    let promise = new Promise((resolve, reject) => {\n      let i = 0;\n      this.users.forEach(user => {\n        i++;\n        this.generalService.getReservationsByUser(user.id).toPromise().then(res => {\n          this.allReservationsFromUsers.push(...res.body);\n          if (i === this.users.length) {\n            resolve();\n          }\n        });\n      });\n    });\n    return promise;\n  }\n  loadCrossSellingEvents() {\n    let promise = new Promise((resolve, reject) => {\n      const res = [];\n      let i = 0;\n      this.allReservationsFromUsers.forEach(element => {\n        i++;\n        res.push(element.event);\n        this.loadReservationsFromEvent(element.event);\n        if (i === this.allReservationsFromUsers.length) {\n          const u = this.getUniqueListBy(res, 'id');\n          this.events = u.sort(() => Math.random() - 0.5);\n          resolve();\n        }\n      });\n    });\n    return promise;\n  }\n  loadReservationsFromEvent(iEvent) {\n    let promise = new Promise((resolve, reject) => {\n      this.organisatorService.findReservationsByEventId(iEvent.id).toPromise().then(res => {\n        iEvent.reservations = res.body;\n        this.loadStars(iEvent).then(() => {\n          resolve();\n        });\n      });\n    });\n    return promise;\n  }\n  // Average of the stars\n  getAverage(eventId) {\n    const se = this.starEvents.find(x => x.event.id === eventId);\n    if (se === null || se === undefined) {\n      return 0;\n    }\n    return se.average;\n  }\n  getUniqueListBy(arr, key) {\n    return [...new Map(arr.map(item => [item[key], item])).values()];\n  }\n}\n_defineProperty(CrossSellingEventsComponent, \"\\u0275fac\", function CrossSellingEventsComponent_Factory(t) {\n  return new (t || CrossSellingEventsComponent)(i0.ɵɵdirectiveInject(i1.GeneralService), i0.ɵɵdirectiveInject(i2.OrganisatorService), i0.ɵɵdirectiveInject(i3.JhiDataUtils));\n});\n_defineProperty(CrossSellingEventsComponent, \"\\u0275cmp\", /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: CrossSellingEventsComponent,\n  selectors: [[\"jhi-cross-selling-events\"]],\n  inputs: {\n    jhiEvent: \"jhiEvent\"\n  },\n  features: [i0.ɵɵNgOnChangesFeature],\n  decls: 2,\n  vars: 1,\n  consts: [[4, \"ngIf\"], [1, \"box_brown\"], [\"jhiTranslate\", \"crossSellingEvents.title\"], [\"layout\", \"grid\", 3, \"value\", \"paginator\", \"rows\"], [\"pTemplate\", \"gridItem\"], [1, \"p-col-12\", \"p-md-3\"], [1, \"card\", \"card-container\"], [3, \"href\"], [1, \"title\"], [1, \"center\"], [3, \"click\"], [\"alt\", \"event image\", 2, \"max-width\", \"250px\", \"max-height\", \"350px\", 3, \"src\"], [1, \"info\"], [1, \"row\"], [1, \"col-md-12\"], [\"jhiTranslate\", \"event-detail.placenumber\"], [\"jhiTranslate\", \"event-detail.price\"], [\"t\", \"\"], [3, \"rate\", \"starTemplate\", \"readonly\", \"max\"], [1, \"heart\"], [1, \"half\"]],\n  template: function CrossSellingEventsComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, CrossSellingEventsComponent_ng_container_0_Template, 13, 3, \"ng-container\", 0);\n      i0.ɵɵtext(1, \"\\n\");\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.loaded);\n    }\n  },\n  dependencies: [i4.NgIf, i5.DataView, i6.PrimeTemplate, i7.NgbRating, i8.TranslateDirective, i4.CurrencyPipe, i4.DatePipe],\n  styles: [\".card[_ngcontent-%COMP%] {\\n  box-shadow: 10px 10px 7px -3px rgba(0, 0, 0, 0.75);\\n  -webkit-box-shadow: 10px 10px 7px -3px rgba(0, 0, 0, 0.75);\\n  -moz-box-shadow: 10px 10px 7px -3px rgba(0, 0, 0, 0.75);\\n  padding: 10px;\\n  \\n  background: #d2ff52;   \\n  background: linear-gradient(to bottom, #d2ff52 0%, #91e842 100%); \\n  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr=\\\"#d2ff52\\\", endColorstr=\\\"#91e842\\\",GradientType=0 ); \\n  height: 800px;\\n  margin: 10px auto;\\n}\\n\\n.center[_ngcontent-%COMP%] {\\n  text-align: center;\\n  margin: 5px auto;\\n}\\n\\n.title[_ngcontent-%COMP%] {\\n  color: black;\\n  font-family: \\\"Knewave\\\", cursive;\\n}\\n\\n.info[_ngcontent-%COMP%] {\\n  color: black;\\n  white-space: inherit;\\n}\\n\\n.heart[_ngcontent-%COMP%] {\\n  position: relative;\\n  display: inline-block;\\n  font-size: 3rem;\\n  color: #d3d3d3;\\n}\\n\\n.full[_ngcontent-%COMP%] {\\n  color: red;\\n}\\n\\n.half[_ngcontent-%COMP%] {\\n  position: absolute;\\n  display: inline-block;\\n  overflow: hidden;\\n  color: red;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9tYWluL3dlYmFwcC9hcHAvdmlld3MvZXZlbnQvY3Jvc3NTZWxsaW5nRXZlbnRzL2Nyb3NzU2VsbGluZ0V2ZW50cy5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGtEQUFBO0VBQ0EsMERBQUE7RUFDQSx1REFBQTtFQUNBLGFBQUE7RUFDQSxzSEFBQTtFQUNBLG1CQUFBLEVBQUEsaUJBQUEsRUFDQSxhQUFBLEVBQ0EsNEJBQUE7RUFDQSxnRUFBQSxFQUFBLHFEQUFBO0VBQ0EsbUhBQUEsRUFBQSxVQUFBO0VBQ0EsYUFBQTtFQUNBLGlCQUFBO0FBQ0Y7O0FBRUE7RUFDRSxrQkFBQTtFQUNBLGdCQUFBO0FBQ0Y7O0FBRUE7RUFDRSxZQUFBO0VBQ0EsK0JBQUE7QUFDRjs7QUFFQTtFQUNFLFlBQUE7RUFDQSxvQkFBQTtBQUNGOztBQUVBO0VBQ0Usa0JBQUE7RUFDQSxxQkFBQTtFQUNBLGVBQUE7RUFDQSxjQUFBO0FBQ0Y7O0FBRUE7RUFDRSxVQUFBO0FBQ0Y7O0FBQ0E7RUFDRSxrQkFBQTtFQUNBLHFCQUFBO0VBQ0EsZ0JBQUE7RUFDQSxVQUFBO0FBRUYiLCJzb3VyY2VzQ29udGVudCI6WyIuY2FyZCB7XG4gIGJveC1zaGFkb3c6IDEwcHggMTBweCA3cHggLTNweCByZ2JhKDAsIDAsIDAsIDAuNzUpO1xuICAtd2Via2l0LWJveC1zaGFkb3c6IDEwcHggMTBweCA3cHggLTNweCByZ2JhKDAsIDAsIDAsIDAuNzUpO1xuICAtbW96LWJveC1zaGFkb3c6IDEwcHggMTBweCA3cHggLTNweCByZ2JhKDAsIDAsIDAsIDAuNzUpO1xuICBwYWRkaW5nOiAxMHB4O1xuICAvKiBQZXJtYWxpbmsgLSB1c2UgdG8gZWRpdCBhbmQgc2hhcmUgdGhpcyBncmFkaWVudDogaHR0cHM6Ly9jb2xvcnppbGxhLmNvbS9ncmFkaWVudC1lZGl0b3IvI2QyZmY1MiswLDkxZTg0MisxMDA7TmVvbiAqL1xuICBiYWNrZ3JvdW5kOiAjZDJmZjUyOyAvKiBPbGQgYnJvd3NlcnMgKi9cbiAgYmFja2dyb3VuZDogLW1vei1saW5lYXItZ3JhZGllbnQodG9wLCAjZDJmZjUyIDAlLCAjOTFlODQyIDEwMCUpOyAvKiBGRjMuNi0xNSAqL1xuICBiYWNrZ3JvdW5kOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudCh0b3AsICNkMmZmNTIgMCUsICM5MWU4NDIgMTAwJSk7IC8qIENocm9tZTEwLTI1LFNhZmFyaTUuMS02ICovXG4gIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20sICNkMmZmNTIgMCUsICM5MWU4NDIgMTAwJSk7IC8qIFczQywgSUUxMCssIEZGMTYrLCBDaHJvbWUyNissIE9wZXJhMTIrLCBTYWZhcmk3KyAqL1xuICBmaWx0ZXI6IHByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5ncmFkaWVudCggc3RhcnRDb2xvcnN0cj0nI2QyZmY1MicsIGVuZENvbG9yc3RyPScjOTFlODQyJyxHcmFkaWVudFR5cGU9MCApOyAvKiBJRTYtOSAqL1xuICBoZWlnaHQ6IDgwMHB4O1xuICBtYXJnaW46IDEwcHggYXV0bztcbn1cblxuLmNlbnRlciB7XG4gIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgbWFyZ2luOiA1cHggYXV0bztcbn1cblxuLnRpdGxlIHtcbiAgY29sb3I6IGJsYWNrO1xuICBmb250LWZhbWlseTogJ0tuZXdhdmUnLCBjdXJzaXZlO1xufVxuXG4uaW5mbyB7XG4gIGNvbG9yOiBibGFjaztcbiAgd2hpdGUtc3BhY2U6IGluaGVyaXQ7XG59XG5cbi5oZWFydCB7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICBmb250LXNpemU6IDNyZW07XG4gIGNvbG9yOiAjZDNkM2QzO1xufVxuXG4uZnVsbCB7XG4gIGNvbG9yOiByZWQ7XG59XG4uaGFsZiB7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICBjb2xvcjogcmVkO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n}));","map":{"version":3,"mappings":"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","names":["i0","CrossSellingEventsComponent","constructor","generalService","organisatorService","dataUtils","ngOnChanges","changes","undefined","jhiEvent","currentValue","loadReservations","then","loadUsers","loadReservationsFromUsers","loadCrossSellingEvents","loaded","openFile","contentType","base64String","loadStars","iEvent","promise","Promise","resolve","reject","getEventStarRatingByEvent","id","toPromise","res","ratings","body","total","forEach","el","stars","avg","length","starEvents","push","event","average","reservations","reservation","users","user","findReservationsByEventId","i","getReservationsByUser","allReservationsFromUsers","element","loadReservationsFromEvent","u","getUniqueListBy","events","sort","Math","random","getAverage","eventId","se","find","x","arr","key","Map","map","item","values","selectors","inputs","features","decls","vars","consts","template"],"sourceRoot":"","sources":["/home/ceo/mmmm/createyourevent/src/main/webapp/app/views/event/crossSellingEvents/crossSellingEvents.component.html","/home/ceo/mmmm/createyourevent/src/main/webapp/app/views/event/crossSellingEvents/crossSellingEvents.component.ts"],"sourcesContent":["<ng-container *ngIf=\"loaded\">\n    <div class=\"box_brown\">\n        <h3 jhiTranslate=\"crossSellingEvents.title\">Customers who bought this also bought ...</h3>\n        <p-dataView [value]=\"events\" [paginator]=\"true\" [rows]=\"8\" layout=\"grid\">\n            <ng-template let-event pTemplate=\"gridItem\">\n                <div class=\"p-col-12 p-md-3\">\n                    <div class=\"card card-container\">\n                        <a href=\"/events/{{ event.id }}/view\">\n                            <h3 class=\"title\">{{ event.name }}</h3>\n                            <div class=\"center\">\n                                <a (click)=\"openFile(event?.flyerContentType!, event?.flyer)\">\n                                    <img [src]=\"'data:' + event.flyerContentType + ';base64,' + event.flyer\" style=\"max-width: 250px; max-height: 350px;\" alt=\"event image\"/>\n                                </a>\n                            </div>\n                            <div class=\"info\">\n                                <hr/>\n                                <div class=\"row\">\n                                  <div class=\"col-md-12\">\n                                    <span jhiTranslate=\"event-detail.placenumber\">Placenumber</span>\n                                  </div>\n                                </div>\n                                <div class=\"row\">\n                                  <div class=\"col-md-12\">\n                                    <span>{{ event.reservations.length }}/{{ event.placenumber }}</span>\n                                  </div>\n                                </div>\n                                <div class=\"row\">\n                                  <div class=\"col-md-12\">\n                                    <span jhiTranslate=\"event-detail.price\">Price</span>\n                                  </div>\n                                </div>\n                                <div class=\"row\">\n                                  <div class=\"col-md-12\">\n                                    <span>{{ event.price | currency }}</span>\n                                  </div>\n                                </div>\n                                <hr/>\n                                <div>{{ event.dateStart | date:'medium' }}</div>\n                                <div>{{ event.dateEnd | date:'medium' }}</div>\n                            </div>\n                            <ng-template #t let-fill=\"fill\">\n                              <span class=\"heart\" [class.full]=\"fill === 100\">\n                                <span class=\"half\" [style.width.%]=\"fill\">&hearts;</span>&hearts;\n                              </span>\n                            </ng-template>\n\n                            <ngb-rating [rate]=\"getAverage(event.id)\" [starTemplate]=\"t\" [readonly]=\"true\" [max]=\"5\"></ngb-rating>\n                        </a>\n                    </div>\n                </div>\n            </ng-template>\n        </p-dataView>\n    </div>\n</ng-container>\n","import { Component, OnChanges, Input, SimpleChanges } from \"@angular/core\";\nimport { IEvent } from \"app/entities/event/event.model\";\nimport { IReservation } from \"app/entities/reservation/reservation.model\";\nimport { IUser } from \"app/entities/user/user.model\";\nimport { GeneralService } from \"app/general.service\";\nimport { OrganisatorService } from \"app/organisator/organisator.service\";\nimport { JhiDataUtils } from \"ng-jhipster\";\n\n\n@Component({\n  selector: 'jhi-cross-selling-events',\n  templateUrl: './crossSellingEvents.component.html',\n  styleUrls: ['./crossSellingEvents.component.scss']\n})\nexport class CrossSellingEventsComponent implements OnChanges {\n  @Input() jhiEvent!: IEvent;\n  users: IUser[] = [];\n  allReservationsFromUsers: IReservation[] = [];\n  events!: IEvent[];\n  starEvents: any[] = [];\n  loaded = false;\n\n  constructor(private generalService: GeneralService, private organisatorService: OrganisatorService, protected dataUtils: JhiDataUtils) {}\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes['jhiEvent'] !== undefined) {\n      this.jhiEvent = changes['jhiEvent'].currentValue;\n\n      this.loadReservations().then(() => {\n        this.loadUsers().then(() => {\n          this.loadReservationsFromUsers().then(() => {\n            this.loadCrossSellingEvents().then(() => {\n              this.loaded = true;\n            });\n          });\n        });\n      });\n    }\n  }\n\n  openFile(contentType: string, base64String: string): void {\n    this.dataUtils.openFile(contentType, base64String);\n  }\n\n  loadStars(iEvent: IEvent) {\n    let promise = new Promise<void>((resolve, reject) => {\n      this.generalService\n        .getEventStarRatingByEvent(iEvent.id!)\n        .toPromise()\n        .then(res => {\n          const ratings = res.body!;\n          let total = 0;\n          ratings.forEach(el => {\n            total += el.stars!;\n          });\n          const avg = (total / ratings.length / 10) * 5;\n          this.starEvents.push({ event: iEvent, average: avg });\n          resolve();\n        });\n    });\n    return promise;\n  }\n\n  loadUsers(): Promise<void> {\n    let promise = new Promise<void>((resolve, reject) => {\n      this.jhiEvent.reservations!.forEach(reservation => {\n        this.users.push(reservation.user!);\n      });\n      resolve();\n    });\n    return promise;\n  }\n\n  loadReservations(): Promise<void> {\n    let promise = new Promise<void>((resolve, reject) => {\n      this.organisatorService\n        .findReservationsByEventId(this.jhiEvent.id!)\n        .toPromise()\n        .then(res => {\n          this.jhiEvent.reservations = res.body;\n          resolve();\n        });\n    });\n    return promise;\n  }\n\n  loadReservationsFromUsers(): Promise<void> {\n    let promise = new Promise<void>((resolve, reject) => {\n      let i = 0;\n      this.users.forEach(user => {\n        i++;\n        this.generalService\n          .getReservationsByUser(user.id)\n          .toPromise()\n          .then(res => {\n            this.allReservationsFromUsers.push(...res.body!);\n            if (i === this.users.length) {\n              resolve();\n            }\n          });\n      });\n    });\n    return promise;\n  }\n\n  loadCrossSellingEvents(): Promise<void> {\n    let promise = new Promise<void>((resolve, reject) => {\n      const res: IReservation[] = [];\n      let i = 0;\n      this.allReservationsFromUsers.forEach(element => {\n        i++;\n        res.push(element.event!);\n        this.loadReservationsFromEvent(element.event!);\n        if (i === this.allReservationsFromUsers.length) {\n          const u = this.getUniqueListBy(res, 'id');\n          this.events = u.sort(() => Math.random() - 0.5);\n          resolve();\n        }\n      });\n    });\n    return promise;\n  }\n\n  loadReservationsFromEvent(iEvent: IEvent): Promise<void> {\n    let promise = new Promise<void>((resolve, reject) => {\n      this.organisatorService\n        .findReservationsByEventId(iEvent.id!)\n        .toPromise()\n        .then(res => {\n          iEvent.reservations = res.body;\n          this.loadStars(iEvent).then(() => {\n            resolve();\n          });\n        });\n    });\n    return promise;\n  }\n\n  // Average of the stars\n  getAverage(eventId: number): number {\n    const se = this.starEvents.find(x => x.event.id === eventId);\n    if (se === null || se === undefined) {\n      return 0;\n    }\n    return se.average;\n  }\n\n  getUniqueListBy(arr: any[], key: any): IEvent[] {\n    return [...new Map(arr.map(item => [item[key], item])).values()];\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}