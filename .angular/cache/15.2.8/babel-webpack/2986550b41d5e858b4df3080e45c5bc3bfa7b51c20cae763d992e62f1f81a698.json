{"ast":null,"code":"import _defineProperty from \"/home/ceo/mmmm/createyourevent/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport { UserPointAssociation } from 'app/entities/user-point-association/user-point-association.model';\nimport * as dayjs from 'dayjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"app/entities/image/service/image.service\";\nimport * as i2 from \"app/general.service\";\nimport * as i3 from \"app/points/points-display/points-display.service\";\nimport * as i4 from \"app/entities/user-point-association/service/user-point-association.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@fortawesome/angular-fontawesome\";\nimport * as i7 from \"../../../shared/language/translate.directive\";\nimport * as i8 from \"primeng/fileupload\";\nimport * as i9 from \"primeng/api\";\nimport * as i10 from \"../gallery-product/gallery-product.component\";\nfunction AdminGalleryProductComponent_ng_container_11_ng_template_4_ul_1_li_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const file_r5 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\"\", file_r5.name, \" - \", file_r5.size, \" bytes\");\n  }\n}\nfunction AdminGalleryProductComponent_ng_container_11_ng_template_4_ul_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\");\n    i0.ɵɵtext(1, \"\\n                \");\n    i0.ɵɵtemplate(2, AdminGalleryProductComponent_ng_container_11_ng_template_4_ul_1_li_2_Template, 2, 2, \"li\", 4);\n    i0.ɵɵtext(3, \"\\n            \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.uploadedFiles);\n  }\n}\nfunction AdminGalleryProductComponent_ng_container_11_ng_template_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"\\n            \");\n    i0.ɵɵtemplate(1, AdminGalleryProductComponent_ng_container_11_ng_template_4_ul_1_Template, 4, 1, \"ul\", 3);\n    i0.ɵɵtext(2, \"\\n        \");\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.uploadedFiles.length);\n  }\n}\nfunction AdminGalleryProductComponent_ng_container_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \"\\n    \");\n    i0.ɵɵelementStart(2, \"p-fileUpload\", 6);\n    i0.ɵɵlistener(\"onUpload\", function AdminGalleryProductComponent_ng_container_11_Template_p_fileUpload_onUpload_2_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.onUpload($event));\n    });\n    i0.ɵɵtext(3, \"\\n        \");\n    i0.ɵɵtemplate(4, AdminGalleryProductComponent_ng_container_11_ng_template_4_Template, 3, 1, \"ng-template\", 7);\n    i0.ɵɵtext(5, \"\\n    \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(6, \"\\n\");\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"url\", ctx_r0.url)(\"fileLimit\", ctx_r0.fileLimit);\n  }\n}\nfunction AdminGalleryProductComponent_ng_container_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \"\\n        \");\n    i0.ɵɵelementStart(2, \"div\", 8);\n    i0.ɵɵtext(3, \"\\n            \");\n    i0.ɵɵelement(4, \"img\", 9);\n    i0.ɵɵtext(5, \"\\n\\n            \");\n    i0.ɵɵelementStart(6, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function AdminGalleryProductComponent_ng_container_15_Template_button_click_6_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r10);\n      const image_r8 = restoredCtx.$implicit;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.deleteImage(image_r8.id));\n    });\n    i0.ɵɵtext(7, \"\\n                \");\n    i0.ɵɵelement(8, \"fa-icon\", 11);\n    i0.ɵɵtext(9, \"\\n                \");\n    i0.ɵɵelementStart(10, \"span\", 12);\n    i0.ɵɵtext(11, \"Delete\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(12, \"\\n            \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(13, \"\\n        \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(14, \"\\n    \");\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const image_r8 = ctx.$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"src\", \"data:\" + image_r8.imageContentType + \";base64,\" + image_r8.image, i0.ɵɵsanitizeUrl);\n  }\n}\nexport class AdminGalleryProductComponent {\n  constructor(imageService, generalService, pointsDataService, userPointAssociationService) {\n    _defineProperty(this, \"imageService\", void 0);\n    _defineProperty(this, \"generalService\", void 0);\n    _defineProperty(this, \"pointsDataService\", void 0);\n    _defineProperty(this, \"userPointAssociationService\", void 0);\n    _defineProperty(this, \"product\", void 0);\n    _defineProperty(this, \"user\", void 0);\n    _defineProperty(this, \"uploadedFiles\", []);\n    _defineProperty(this, \"images\", void 0);\n    _defineProperty(this, \"url\", void 0);\n    _defineProperty(this, \"fileLimit\", 10);\n    this.imageService = imageService;\n    this.generalService = generalService;\n    this.pointsDataService = pointsDataService;\n    this.userPointAssociationService = userPointAssociationService;\n  }\n  ngOnInit() {\n    if (this.user && this.product) {\n      this.url = '/api/upload/' + this.product.id + '/' + this.user.id + '/product';\n      this.generalService.findImagesByProductId(this.product.id).subscribe(res => {\n        this.images = res.body;\n        this.fileLimit = 10 - this.images.length;\n      });\n    }\n  }\n  ngOnChanges(changes) {\n    if (changes['product'] !== undefined) {\n      this.product = changes['product'].currentValue;\n      if (this.user && this.product) {\n        this.ngOnInit();\n      }\n    }\n    if (changes['user'] !== undefined) {\n      this.user = changes['user'].currentValue;\n      if (this.user && this.product) {\n        this.ngOnInit();\n      }\n    }\n  }\n  onUpload(event) {\n    for (const file of event.files) {\n      this.uploadedFiles.push(file);\n    }\n    this.generalService.findPointsByKey('upload_image_product').subscribe(p => {\n      const points = p.body;\n      this.generalService.findUserPointAssociationByUsersIdAndPointkey(this.user.id, points.key).subscribe(s => {\n        const upa = s.body;\n        const day = dayjs().date();\n        let i = 0;\n        upa.forEach(element => {\n          if (element.date.date() === day) {\n            i++;\n          }\n        });\n        if (i < points.countPerDay) {\n          const iupa = new UserPointAssociation();\n          iupa.users = this.user;\n          iupa.points = points;\n          iupa.date = dayjs();\n          this.userPointAssociationService.create(iupa).subscribe();\n          const img_points = points.points * this.uploadedFiles.length;\n          this.user.points += img_points;\n          this.user.loggedIn = true;\n          this.generalService.updateUserLoggedInAndPoints(this.user.id, this.user.loggedIn, this.user.points).subscribe(t => {\n            this.generalService.findWidthAuthorities().subscribe(k => {\n              this.pointsDataService.changePoint(k.body.points);\n            });\n          });\n        }\n      });\n    });\n    this.generalService.findImagesByProductId(this.product.id).subscribe(res => {\n      this.images = res.body;\n      this.fileLimit = 10 - this.images.length;\n    });\n  }\n  deleteImage(imageId) {\n    this.imageService.delete(imageId).subscribe(() => {\n      this.generalService.findImagesByProductId(this.product.id).subscribe(res => {\n        this.images = res.body;\n        this.fileLimit = 10 - this.images.length;\n      });\n    });\n  }\n}\n_defineProperty(AdminGalleryProductComponent, \"\\u0275fac\", function AdminGalleryProductComponent_Factory(t) {\n  return new (t || AdminGalleryProductComponent)(i0.ɵɵdirectiveInject(i1.ImageService), i0.ɵɵdirectiveInject(i2.GeneralService), i0.ɵɵdirectiveInject(i3.PointsDataService), i0.ɵɵdirectiveInject(i4.UserPointAssociationService));\n});\n_defineProperty(AdminGalleryProductComponent, \"\\u0275cmp\", /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: AdminGalleryProductComponent,\n  selectors: [[\"jhi-admin-gallery-product\"]],\n  inputs: {\n    product: \"product\",\n    user: \"user\"\n  },\n  features: [i0.ɵɵNgOnChangesFeature],\n  decls: 25,\n  vars: 3,\n  consts: [[\"role\", \"alert\", 1, \"alert\", \"alert-info\"], [\"jhiTranslate\", \"admin-gallery-product.title\"], [\"jhiTranslate\", \"admin-gallery-product.info\"], [4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [3, \"images\"], [\"name\", \"files\", \"multiple\", \"multiple\", \"accept\", \"image/*\", \"maxFileSize\", \"1000000\", 3, \"url\", \"fileLimit\", \"onUpload\"], [\"pTemplate\", \"content\"], [1, \"image\"], [\"alt\", \"image.name\", 2, \"max-height\", \"150px\", 3, \"src\"], [1, \"btn\", \"btn-danger\", \"btn-sm\", 3, \"click\"], [\"icon\", \"times\"], [\"jhiTranslate\", \"entity.action.delete\", 1, \"d-none\", \"d-md-inline\"]],\n  template: function AdminGalleryProductComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵtext(1, \"\\n    \");\n      i0.ɵɵelementStart(2, \"h2\", 1);\n      i0.ɵɵtext(3, \"Product-Gallery\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(4, \"\\n    \");\n      i0.ɵɵelementStart(5, \"p\", 2);\n      i0.ɵɵtext(6, \"\\n        Below you can insert a maximum of 10 pictures of your product in order to present your goods to the end customer in terms of appearance.\\n    \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(7, \"\\n\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(8, \"\\n\");\n      i0.ɵɵelement(9, \"hr\");\n      i0.ɵɵtext(10, \"\\n\");\n      i0.ɵɵtemplate(11, AdminGalleryProductComponent_ng_container_11_Template, 7, 2, \"ng-container\", 3);\n      i0.ɵɵtext(12, \"\\n\");\n      i0.ɵɵelementStart(13, \"p\");\n      i0.ɵɵtext(14, \"\\n    \");\n      i0.ɵɵtemplate(15, AdminGalleryProductComponent_ng_container_15_Template, 15, 1, \"ng-container\", 4);\n      i0.ɵɵtext(16, \"\\n\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(17, \"\\n\");\n      i0.ɵɵelement(18, \"hr\");\n      i0.ɵɵtext(19, \"\\n\");\n      i0.ɵɵelementStart(20, \"p\");\n      i0.ɵɵtext(21, \"\\n    \");\n      i0.ɵɵelement(22, \"jhi-gallery-product\", 5);\n      i0.ɵɵtext(23, \"\\n\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(24, \"\\n\");\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(11);\n      i0.ɵɵproperty(\"ngIf\", ctx.product && ctx.user && !((ctx.images == null ? null : ctx.images.length) >= 10));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngForOf\", ctx.images);\n      i0.ɵɵadvance(7);\n      i0.ɵɵproperty(\"images\", ctx.images);\n    }\n  },\n  dependencies: [i5.NgForOf, i5.NgIf, i6.FaIconComponent, i7.TranslateDirective, i8.FileUpload, i9.PrimeTemplate, i10.GalleryProductComponent],\n  styles: [\".image[_ngcontent-%COMP%] {\\n  margin: 15px;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9tYWluL3dlYmFwcC9hcHAvdmlld3MvcHJvZHVjdC9hZG1pbi1nYWxsZXJ5LXByb2R1Y3QvYWRtaW4tZ2FsbGVyeS1wcm9kdWN0LmNvbXBvbmVudC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UsWUFBQTtBQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLmltYWdlIHtcbiAgbWFyZ2luOiAxNXB4O1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n}));","map":{"version":3,"mappings":"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","names":["UserPointAssociation","dayjs","i0","AdminGalleryProductComponent","constructor","imageService","generalService","pointsDataService","userPointAssociationService","ngOnInit","user","product","url","id","findImagesByProductId","subscribe","res","images","body","fileLimit","length","ngOnChanges","changes","undefined","currentValue","onUpload","event","file","files","uploadedFiles","push","findPointsByKey","p","points","findUserPointAssociationByUsersIdAndPointkey","key","s","upa","day","date","i","forEach","element","countPerDay","iupa","users","create","img_points","loggedIn","updateUserLoggedInAndPoints","t","findWidthAuthorities","k","changePoint","deleteImage","imageId","delete","selectors","inputs","features","decls","vars","consts","template"],"sourceRoot":"","sources":["/home/ceo/mmmm/createyourevent/src/main/webapp/app/views/product/admin-gallery-product/admin-gallery-product.component.ts","/home/ceo/mmmm/createyourevent/src/main/webapp/app/views/product/admin-gallery-product/admin-gallery-product.component.html"],"sourcesContent":["import { Component, OnInit, OnChanges, Input, SimpleChanges } from '@angular/core';\nimport { IImage } from 'app/entities/image/image.model';\nimport { ImageService } from 'app/entities/image/service/image.service';\nimport { IProduct } from 'app/entities/product/product.model';\nimport { UserPointAssociationService } from 'app/entities/user-point-association/service/user-point-association.service';\nimport { UserPointAssociation } from 'app/entities/user-point-association/user-point-association.model';\nimport { IUser } from 'app/entities/user/user.model';\nimport { GeneralService } from 'app/general.service';\nimport { PointsDataService } from 'app/points/points-display/points-display.service';\nimport * as dayjs from 'dayjs';\n\n@Component({\n  selector: 'jhi-admin-gallery-product',\n  templateUrl: './admin-gallery-product.component.html',\n  styleUrls: ['admin-gallery-product.component.scss']\n})\nexport class AdminGalleryProductComponent implements OnInit, OnChanges {\n  @Input() product!: IProduct;\n  @Input() user!: IUser;\n  uploadedFiles: any[] = [];\n  images!: IImage[];\n  url!: string;\n  fileLimit = 10;\n\n  constructor(\n    private imageService: ImageService,\n    private generalService: GeneralService,\n    private pointsDataService: PointsDataService,\n    private userPointAssociationService: UserPointAssociationService\n  ) {}\n  ngOnInit(): void {\n    if (this.user && this.product) {\n      this.url = '/api/upload/' + this.product.id + '/' + this.user.id + '/product';\n      this.generalService.findImagesByProductId(this.product.id!).subscribe(res => {\n        this.images = res.body!;\n        this.fileLimit = 10 - this.images.length;\n      });\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes['product'] !== undefined) {\n      this.product = changes['product'].currentValue;\n      if (this.user && this.product) {\n        this.ngOnInit();\n      }\n    }\n    if (changes['user'] !== undefined) {\n      this.user = changes['user'].currentValue;\n      if (this.user && this.product) {\n        this.ngOnInit();\n      }\n    }\n  }\n\n  onUpload(event: any): void {\n    for (const file of event.files) {\n      this.uploadedFiles.push(file);\n    }\n\n    this.generalService.findPointsByKey('upload_image_product').subscribe(p => {\n      const points = p.body!;\n      this.generalService.findUserPointAssociationByUsersIdAndPointkey(this.user.id, points.key!).subscribe(s => {\n        const upa = s.body!;\n        const day = dayjs().date();\n        let i = 0;\n        upa.forEach(element => {\n          if (element.date!.date() === day) {\n            i++;\n          }\n        });\n        if (i < points.countPerDay!) {\n          const iupa = new UserPointAssociation();\n          iupa.users = this.user;\n          iupa.points = points;\n          iupa.date = dayjs();\n          this.userPointAssociationService.create(iupa).subscribe();\n          const img_points = points.points! * this.uploadedFiles.length;\n          this.user.points += img_points;\n          this.user.loggedIn = true;\n          this.generalService.updateUserLoggedInAndPoints(this.user.id, this.user.loggedIn, this.user.points).subscribe(t => {\n            this.generalService.findWidthAuthorities().subscribe(k => {\n              this.pointsDataService.changePoint(k.body.points);\n            });\n          });\n        }\n      });\n    });\n\n    this.generalService.findImagesByProductId(this.product.id!).subscribe(res => {\n      this.images = res.body!;\n      this.fileLimit = 10 - this.images.length;\n    });\n  }\n\n  deleteImage(imageId: number): void {\n    this.imageService.delete(imageId).subscribe(() => {\n      this.generalService.findImagesByProductId(this.product.id!).subscribe(res => {\n        this.images = res.body!;\n        this.fileLimit = 10 - this.images.length;\n      });\n    });\n  }\n}\n","<div class=\"alert alert-info\" role=\"alert\">\n    <h2 jhiTranslate=\"admin-gallery-product.title\">Product-Gallery</h2>\n    <p jhiTranslate=\"admin-gallery-product.info\">\n        Below you can insert a maximum of 10 pictures of your product in order to present your goods to the end customer in terms of appearance.\n    </p>\n</div>\n<hr/>\n<ng-container *ngIf=\"product && user && !(images?.length >= 10)\">\n    <p-fileUpload name=\"files\" [url]=\"url\" (onUpload)=\"onUpload($event)\"\n            multiple=\"multiple\" accept=\"image/*\" maxFileSize=\"1000000\" [fileLimit]=\"fileLimit\">\n        <ng-template pTemplate=\"content\">\n            <ul *ngIf=\"uploadedFiles.length\">\n                <li *ngFor=\"let file of uploadedFiles\">{{file.name}} - {{file.size}} bytes</li>\n            </ul>\n        </ng-template>\n    </p-fileUpload>\n</ng-container>\n<p>\n    <ng-container *ngFor=\"let image of images\">\n        <div class=\"image\">\n            <img [src]=\"'data:' + image.imageContentType + ';base64,' + image.image\" style=\"max-height: 150px;\" alt=\"image.name\"/>\n\n            <button (click)=\"deleteImage(image.id)\" class=\"btn btn-danger btn-sm\">\n                <fa-icon icon=\"times\"></fa-icon>\n                <span class=\"d-none d-md-inline\" jhiTranslate=\"entity.action.delete\">Delete</span>\n            </button>\n        </div>\n    </ng-container>\n</p>\n<hr/>\n<p>\n    <jhi-gallery-product [images]=\"images\"></jhi-gallery-product>\n</p>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}