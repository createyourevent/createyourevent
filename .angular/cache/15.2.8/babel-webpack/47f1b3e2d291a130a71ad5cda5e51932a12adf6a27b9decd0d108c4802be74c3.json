{"ast":null,"code":"import { MessageService } from 'primeng/api';\nimport { DialogService } from 'primeng/dynamicdialog';\nimport { BuyTicketDatatransComponent } from './buy-ticket-datatrans/buy-ticket-datatrans.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"primeng/api\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"app/general.service\";\nimport * as i4 from \"app/entities/event/service/event.service\";\nimport * as i5 from \"primeng/dynamicdialog\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"../../shared/language/translate.directive\";\nimport * as i8 from \"primeng/button\";\nimport * as i9 from \"primeng/toast\";\nexport let BuyTicketComponent = /*#__PURE__*/(() => {\n  class BuyTicketComponent {\n    constructor(messageService, route, generalService, eventService, dialogService) {\n      this.messageService = messageService;\n      this.route = route;\n      this.generalService = generalService;\n      this.eventService = eventService;\n      this.dialogService = dialogService;\n      this.allSelledTickets = [];\n    }\n    ngOnInit() {\n      this.route.params.subscribe(params => {\n        const eventId = params['eventId'];\n        this.eventService.find(eventId).subscribe(e => {\n          this.jhiEvent = e.body;\n          this.generalService.findWidthAuthorities().subscribe(u => {\n            this.user = u.body;\n          });\n          this.generalService.findTicketsByEventId(this.jhiEvent.id).subscribe(t => {\n            this.allSelledTickets = t.body;\n          });\n        });\n      });\n    }\n    totalTickets() {\n      let total = 0;\n      this.allSelledTickets.forEach(ticket => {\n        total += ticket.amount;\n      });\n      return total;\n    }\n    enoughtTickets() {\n      if (this.jhiEvent.placenumber - this.totalTickets() - this.amount < 0) {\n        return false;\n      }\n      return true;\n    }\n    changeAmount(e) {\n      if (this.jhiEvent.placenumber - this.totalTickets() - e < 0) {\n        this.messageService.add({\n          severity: 'error',\n          summary: 'Not enought tickets to sell',\n          detail: 'There aren\\'t as many tickets left for this event as you\\'d like. We are sorry.'\n        });\n      }\n    }\n    openPayment() {\n      this.ref = this.dialogService.open(BuyTicketDatatransComponent, {\n        header: 'Datatrans-Terminal',\n        width: '70%',\n        contentStyle: {\n          \"max-height\": \"500px\",\n          \"overflow\": \"auto\"\n        },\n        baseZIndex: 10,\n        data: {\n          event: this.jhiEvent,\n          user: this.user,\n          type: 'buyTicket',\n          id: this.jhiEvent.id,\n          amount: this.amount\n        }\n      });\n    }\n  }\n  BuyTicketComponent.ɵfac = function BuyTicketComponent_Factory(t) {\n    return new (t || BuyTicketComponent)(i0.ɵɵdirectiveInject(i1.MessageService), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i3.GeneralService), i0.ɵɵdirectiveInject(i4.EventService), i0.ɵɵdirectiveInject(i5.DialogService));\n  };\n  BuyTicketComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: BuyTicketComponent,\n    selectors: [[\"jhi-buy-ticket\"]],\n    features: [i0.ɵɵProvidersFeature([MessageService, DialogService])],\n    decls: 23,\n    vars: 3,\n    consts: [[\"jhiTranslate\", \"buy-ticket.title\"], [\"jhiTranslate\", \"buy-ticket.info\"], [1, \"p-formgroup-inline\"], [1, \"p-field\"], [\"for\", \"amount\", 1, \"p-sr-only\"], [\"id\", \"amount\", \"type\", \"number\", \"pInputText\", \"\", 3, \"ngModel\", \"change\", \"ngModelChange\"], [\"pButton\", \"\", \"type\", \"button\", \"label\", \"Buy ticket\", 3, \"disabled\", \"click\"]],\n    template: function BuyTicketComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"p-toast\");\n        i0.ɵɵtext(1, \"\\n\");\n        i0.ɵɵelementStart(2, \"h1\")(3, \"span\", 0);\n        i0.ɵɵtext(4, \"Buy tickets for\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(6, \"\\n\\n\");\n        i0.ɵɵelementStart(7, \"p\", 1);\n        i0.ɵɵtext(8, \"\\n  Please insert how many tickets you will buy and press submit.\\n\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(9, \"\\n\\n\");\n        i0.ɵɵelementStart(10, \"div\", 2);\n        i0.ɵɵtext(11, \"\\n  \");\n        i0.ɵɵelementStart(12, \"div\", 3);\n        i0.ɵɵtext(13, \"\\n      \");\n        i0.ɵɵelementStart(14, \"label\", 4);\n        i0.ɵɵtext(15, \"Amount\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(16, \"\\n      \");\n        i0.ɵɵelementStart(17, \"input\", 5);\n        i0.ɵɵlistener(\"change\", function BuyTicketComponent_Template_input_change_17_listener($event) {\n          return ctx.changeAmount($event.target.value);\n        })(\"ngModelChange\", function BuyTicketComponent_Template_input_ngModelChange_17_listener($event) {\n          return ctx.amount = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(18, \"\\n  \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(19, \"\\n  \");\n        i0.ɵɵelementStart(20, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function BuyTicketComponent_Template_button_click_20_listener() {\n          return ctx.openPayment();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(21, \"\\n\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(22, \"\\n\");\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate1(\" \", ctx.jhiEvent.name, \"\");\n        i0.ɵɵadvance(12);\n        i0.ɵɵproperty(\"ngModel\", ctx.amount);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"disabled\", !ctx.enoughtTickets());\n      }\n    },\n    dependencies: [i6.DefaultValueAccessor, i6.NumberValueAccessor, i6.NgControlStatus, i6.NgModel, i7.TranslateDirective, i8.ButtonDirective, i9.Toast]\n  });\n  return BuyTicketComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}